---
title: "Atacicept"
author: "Amil0505"
date: "2025-12-05"
output: 
  html_document:
    toc: true          # 目次を表示
    toc_depth: 4       # 見出しの階層
    toc_float: true    # 左側に固定してスクロール追従
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# はじめに

本ページではNew England Journal of Medicineに掲載されていた、Atapiceptという新薬の第三相試験について、プロトコルや解析計画書の気になった部分を勉強していきたいと思います。基本的には主要評価項目に対する統計的な部分のみに焦点を当てていきます。

論文： Lafayette R, Barbour SJ, Brenner RM, Campbell KN, Doan T, Eren N, Floege J, Jha V, Kim BS, Liew A, Maes B, Pal A, Pecoits-Filho R, Phoon RKS, Rizk DV, Suzuki H, Tesař V, Trimarchi H, Wei X, Zhang H, Barratt J; ORIGIN Phase 3 Trial Investigators. A Phase 3 Trial of Atacicept in Patients with IgA Nephropathy. N Engl J Med. 2025 Nov 6. doi: 10.1056/NEJMoa2510198.

## 論文の概要

まず、論文から試験概要や結果などを簡単にまとめます。詳細は論文をご確認ください。

### 試験概要

| 項目                     | 説明                                               | 備考                                       |
|------------------|-----------------------------|-------------------------|
| 対象疾患                 | IgA腎症                                            |                                            |
| 対象治療                 | Atacicept(150mg)                                   |                                            |
| デザイン                 | 二重盲検プラセボ対照優越性試験                     | 層別ランダム化 (8層)                       |
| 主要評価項目             | 尿蛋白とクレアチニンの比のベースラインからの変化量 | 対数変換などしていますが今回は省略         |
| 主要項目に対する解析手法 | MMRM                                               | 評価時点は12,24,36週目＊主要評価は36週時点 |
| 症例数設計               | 各群100例                                          | t検定に基づく                              |

### 主要評価項目に対する解析

MMRM\
固定効果： 群、時点(カテゴリ変数)、群×時点、割付調整因子4つ(ベースライン値(二値)、eGFRのベースライン値(二値)、SGLT2阻害薬の使用有無、地域(アジアかそれ以外))\
変量効果：症例\

### 結果

36週時点での最小二乗平均差41.8(95%CI：28.9 to 52.3)ということで、Ataciceptの有効性が示されました。

## プロトコルAmendment5.0の記載

次に、プロトコルAmendment5.0に記載されている統計解析部分、特に主要評価項目の解析手法とEstimandに関する記述を見ていきます。\
＊論文では多重性の調整なども行っていますが、今回はスキップします。

### 中間事象と主要な解析での対処法

| 列挙されている中間事象              | 対処法                                     | 備考               |
|-------------------------|-----------------------------|------------------|
| 治療の中止                          | 中止後のデータも解析に使用                 | 試験の中止ではない |
| 併用禁止/レスキュー薬や療法の使用　 | 使用後のデータは打ち切り(解析に使用しない) |                    |
| 試験からの脱落、中止                | MARを仮定した解析で欠測に対処              | 　                 |
| 追跡不能                            | MARを仮定した解析で欠測に対処              |                    |
| 死亡                                | MARを仮定した解析で欠測に対処              |                    |

### 主要な解析

解析手法：MMRM\
固定効果： 群、時点(カテゴリ変数)、群×時点、割付調整因子4つ(ベースライン値、eGFRのベースライン値、SGLT2阻害薬の使用有無、地域(アジアかそれ以外))\
変量効果：症例\

### 感度解析と補足的解析

感度解析：\
・Tipping point解析\
・治療方針戦略(併用禁止/レスキュー薬や療法の使用後のデータも解析に使用)

補足的解析：\
PPS(定義は論文をご参照ください)を対象にした解析

## 統計解析計画書1.0版の記載

次に、統計解析計画書1.0版の記載を見ていきます。\
本研究ではプロトコルや解析計画書の固定日が下記のようになっており、(規制当局との相談などを経て？)プロトコルAmendment5.0と統計解析計画書1.0版でEstimandが変更されています。\
2023/2/23：プロトコルAmendment5.0\
2024/4/13：統計解析計画書1.0版\
2024/12/23：プロトコルAmendment7.0\
2025/4/23：統計解析計画書2.0版\
統計解析計画書1.0版以降の文書ではEstimandの変更はあまりないため、今回は省略します。\

### 中間事象と主要な解析での対処法

| 列挙されている中間事象          | 対処法(下記) | 備考 |
|---------------------------------|--------------|------|
| (1)治療の中止                   |              |      |
| (2)レスキュー薬や療法の使用　   |              |      |
| (3)併用禁止薬や療法の使用       |              | 　   |
| (4)透析、腎移植、または死亡     |              |      |
| (5)追跡不能を含む試験からの脱落 |              |      |

Step1：中間事象に対する方針\
(1)治療の中止：治療方針ストラテジーに基づき、中止後のデータも含めて観測されているデータを使用\
(2)レスキュー薬や療法の使用：治療方針ストラテジーに基づき、使用後のデータも含めて観測されているデータを使用\
(3)併用禁止薬や療法の使用：治療方針ストラテジーに基づき、使用後のデータも含めて観測されているデータを使用\
(4)透析、腎移植、または死亡：これらの中間事象後のデータは解釈が難しいため、解析から除外

Step2：間欠的(Intermittent)な欠測への対処\
MARを仮定し、治療群別に多重代入(50回)\
- SASのPROC MI のMCMC monotone オプションを使用

Step3：中間事象による欠測への対処\
・Step2で補完後のデータにおける欠測は、仮想ストラテジーに従って、Jump to Referenceにより補完\
・(4)透析、腎移植、または死亡 が生じた症例については、ワーストケースアプローチ(不利な(効果が悪い)値にランダム誤差を加えた値を補完)\
→jump to Referenceで補完した値をワーストケースアプローチで置換\
　＊(4)の後に他の中間事象が生じた場合は(4)の対処(ワーストケースアプローチ)を優先\
　＊不利な値の定義：Step1の観察データを用いて全てのvisitおよび両治療群から得られたeGFRの1%点(ランダム誤差もStep1の観察データから推定)\
・(4)が生じずに試験から脱落した場合はJump to Referenceにより補完する

Step4：統計解析\
MMRMを実施し、Rubin's ruleで結果を統合

### 主要な解析

解析手法：MMRM\
固定効果：群、時点(カテゴリ変数)、群×時点、割付調整因子4つ(ベースライン値、eGFRのベースライン値、SGLT2阻害薬の使用有無、地域(アジアかそれ以外))\
変量効果：症例\
分散共分散構造：無構造\
＊収束しない場合はRobin's ruleを用いた統合の計算から除外

### 感度解析と補足的解析

感度解析1：While-on-treatment 解析\
・全ての中間事象の扱いはWhile-on-treatmentストラテジーを採用\
　- 最初の中間事象までに観測された全てのデータを使用\
　- 最初の中間事象後に観測されたデータは欠測として扱う\
・上記対応で欠測しているデータは仮想ストラテジーに従って補完\
　- 間欠的な欠測に対しては、主解析のStep2と同様\
　- その他の欠測については、治療群ごとにPROC MI のMOTONONE ステートメントのRegressionオプションを使用\
・補完されたデータセットそれぞれに対してMMRMを行い、Rubin's rule で統合

感度解析2：Tipping point解析\
・MNARの仮定に基づく delta調整法を実施する\
　- シフトパラメータは-2.7から2.7まで0.2刻み\
　- Tipping pointが特定されない場合は、適宜調整する\
・Tipping pointが特定されたのち、そのポイントにおける仮定の妥当性について臨床的に検討を行う\

補足的解析：\
・PPSを対象に治療方針ストラテジーに従った解析を行う。\
　- ただし、(4)が生じた後のデータは解析から除外する\
　- それ以外は主要な解析と同様\

＊Tipping point 解析やJump to Reference解析の手法の詳細は別の機会にまとめる予定です(勉強中)。\
参考：Mallinckrodt C, Molenberghs G, Lipkovich I, Ratitch B. Estimands, estimators and sensitivity analysis in clinical trials. 1st ed. Boca Raton: Chapman & Hall/CRC; 2020.

### プロトコルAmendment5.0と統計解析計画書1.0版の中間事象とその取扱いの主な違い

プロトコルAmendment5.0と統計解析計画書1.0版で個人的に気になった違いは下記です。\

・列挙されている中間事象\
　- 統計解析計画書では、死亡に加え、透析および腎移植が中間事象として列挙\
・中間事象への対処法\
　- レスキュー薬/併用禁止薬への対処方法が仮想ストラテジー(MMRMなので使用しなかった場合の効果の推定?)から治療方針ストラテジーに変更\
　- 透析、腎移植、死亡の対処法としてワーストケースアプローチを採用\

基本的には新薬の効果を保守的に推定する方向に修正しているように感じるので、規制当局的にも試験開始後のEstimandの修正はOKなのかなと思いました(二重盲検でもあるので)。\

## 解析の再現

人工的にデータを生成して解析計画書1.0版の主要な解析を再現していきたいと思います。\
再現の目的は実装方法の勉強のため、データ生成プロセスなどは簡略化している部分があります。\
Supplementの統計解析計画書の最後にSASのコードが記載されているため、それを参考にしています。\
なお、Rmarkdown上でSASmarkdownによるSASの実装に苦戦したため、本ページではデータの生成のみを行い、SASでの解析は別ファイルにて行います。

### データの生成

論文を参考に、Chatgptに人工的にデータを生成してもらいます。\
簡単のため、背景情報は省略し、治療群とアウトカムのみを再現してもらいます。\

```{r data_gen}
set.seed(123)

# 患者数
n_placebo <- 100
n_atacicept <- 100

# 週
weeks <- c(0, 12, 24, 36)

# 平均値（グラフ参考）
mean_placebo <- c(0, -8, -9, -7)       # おおよそグラフ通り
mean_atacicept <- c(0, -30, -38, -46)  # おおよそグラフ通り

# 標準偏差の推定（グラフのエラーバーから概算）
sd_placebo <- c(5, 8, 8, 10)
sd_atacicept <- c(5, 10, 10, 10)

# データフレーム作成
generate_group <- function(n, mean_vec, sd_vec, group_name){
  data <- data.frame(
    PatientID = 1:n
  )
  for(i in 1:length(weeks)){
    week <- weeks[i]
    data[[paste0("Week", week)]] <- rnorm(n, mean = mean_vec[i], sd = sd_vec[i])
  }
  data$trt <- group_name
  return(data)
}

placebo_data <- generate_group(n_placebo, mean_placebo, sd_placebo, "Placebo")
atacicept_data <- generate_group(n_atacicept, mean_atacicept, sd_atacicept, "Atacicept")

# 結合
full_data <- rbind(placebo_data, atacicept_data)

# 確認
head(full_data)
summary(full_data)

#データをlong形式に変換
library(dplyr)
library(tidyr)

long_data <- full_data %>%
  pivot_longer(
    cols = starts_with("Week"),
    names_to = "Week",
    values_to = "Outcome"
  ) %>%
  mutate(Week = as.numeric(gsub("Week", "", Week)))  # Week列を数値に変換

head(long_data)


```

### 欠測の生成

次に、欠測を生成していきます。\
簡単のため、\
①間欠的な欠測と\
②ある時点(中間事象や脱落が生じた時点を想定)以降はずっと欠測\
の2パターンの欠測を生成します。

②の想定として、\
1. 透析/腎移植/死亡による欠測(実際の試験では収集されていても解釈が難しいため主要な解析では欠測扱い)\
2. 試験からの脱落などによる欠測\
などがあります。\
＊治療の中止やレスキュー治療後のデータは主要な解析では治療方針ストラテジーのため、欠測扱いとはしていません。

```{r missing_gen}

weeks_followup <- c(12, 24, 36)

# 欠測確率の設定（調整しやすい）
p_intermittent <- 0.10   # ① 各時点10%
p_monotone     <- 0.20   # ② 患者の20%に中間事象

weeks_followup <- c(12, 24, 36)

# 欠測確率
p_intermittent <- 0.10   # 間欠欠測
p_monotone     <- 0.20   # 中間事象あり

missing_design <- long_data %>%
  distinct(PatientID, trt) %>%
  mutate(
    # 中間事象の有無（患者単位）
    monotone_flag = rbinom(n(), 1, p_monotone),

    # 中間事象発生時点
    monotone_start = ifelse(
      monotone_flag == 1,
      sample(weeks_followup, n(), replace = TRUE),
      NA
    ),

    # 欠測理由（中間事象がある人のみ）
    missing_reason = case_when(
      monotone_flag == 1 ~ sample(c(1, 2), n(), replace = TRUE),
      TRUE ~ 0
    )
  )

long_data_miss <- long_data %>%
  left_join(missing_design, by = c("PatientID", "trt")) %>%
  mutate(
    # ② 中間事象以降はすべて欠測
    miss_monotone = ifelse(
      monotone_flag == 1 & Week >= monotone_start,
      1, 0
    ),

    # ① 間欠欠測（中間事象なし・ベースライン以外）
    miss_intermittent = ifelse(
      monotone_flag == 0 & Week != 0,
      rbinom(n(), 1, p_intermittent),
      0
    ),

    # 最終欠測フラグ
    missing = ifelse(
      miss_monotone == 1 | miss_intermittent == 1,
      1, 0
    ),

    # 観測値
    Outcome_obs = ifelse(missing == 1, NA, Outcome)
  )

analysis_data <- long_data_miss %>%
  mutate(
    missing_reason = factor(
      missing_reason,
      levels = c(0, 1, 2),
      labels = c(
        "Observed",
        "Dialysis/Transplant/Death",
        "Dropout"
      )
    )
  )

##欠測の確認
analysis_data %>%
  group_by(trt, Week) %>%
  summarise(
    missing_rate = mean(is.na(Outcome_obs)),
    .groups = "drop"
  )


```

次に、欠測のないデータと欠測のあるデータの比較をしていきます。

```{r summary_full}
##欠測のないデータの平均とSD
summary_complete <- long_data %>%
  group_by(trt, Week) %>%
  summarise(
    mean = mean(Outcome),
    sd   = sd(Outcome),
    n    = n(),
    .groups = "drop"
  )

summary_complete
```

```{r line_full}
#折れ線グラフの描写
library(ggplot2)

ggplot(summary_complete, aes(x = Week, y = mean, color = trt, group = trt)) +
  geom_line(size = 1) +                # 平均値の折れ線
  geom_point(size = 2) +               # 平均値の点
  geom_errorbar(aes(ymin = mean - sd,
                    ymax = mean + sd),
                width = 1) +           # SDのエラーバー
  scale_x_continuous(breaks = c(0, 12, 24, 36)) +  # 横軸目盛を指定
  theme_minimal() +
  labs(x = "Week", y = "Change from baseline", 
       title = "Mean ± SD over Time") +
  scale_color_manual(values = c("Placebo" = "blue", "Atacicept" = "red"))


```

概ね、論文通りのグラフが作成できています。\

```{r summary_miss}
summary_missing <- analysis_data %>%
  group_by(trt, Week) %>%
  summarise(
    n_obs = sum(!is.na(Outcome_obs)),     # 観測症例数
    mean  = mean(Outcome_obs, na.rm = TRUE),
    sd    = sd(Outcome_obs, na.rm = TRUE),
    .groups = "drop"
  )

summary_missing


```

```{r line_miss}
ggplot(summary_missing, aes(x = Week, y = mean, color = trt, group = trt)) +
  geom_line(size = 1) +                # 平均値の折れ線
  geom_point(size = 2) +               # 平均値の点
  geom_errorbar(aes(ymin = mean - sd,
                    ymax = mean + sd),
                width = 1) +           # SDのエラーバー
  scale_x_continuous(breaks = c(0, 12, 24, 36)) +  # 横軸目盛を指定
  theme_minimal() +
  labs(x = "Week", y = "Change from baseline", 
       title = "Mean ± SD over Time") +
  scale_color_manual(values = c("Placebo" = "blue", "Atacicept" = "red"))

```

今回はランダムに欠測を生成しているため、欠測生成前のデータと欠測生成後のデータで分布に違いはなさそうです。\

実務ではこのあたりからSASを使うことになると思うので、Rでcsv出力し、別ページにてSASで解析を行います。\
＊Rのhavenパッケージを用いてSASデータで出力するとなぜかファイルが壊れるためcsvで出力\

```{r csv}
#Rでcsvデータとして出力
#write.csv( analysis_data, "C:/Users/XXX/Desktop/Journal/Atacicept/analysis_data.csv", row.names = FALSE, fileEncoding = "UTF-8" )
#適宜パスを設定
```
